<!DOCTYPE html>

<head>

<style>
#cs{ 
    display:none;
}

.result {
    background-color: white;
    color: black;
}
    </style>

</head>

<body>

<!-- Input file from computer. -->
<input id="inputFileToLoad" type="file" onchange="encodeImageFileAsURL();" />

<!-- Shows image on screen. -->
<div class="thumbnail">
  <div class="preview"></div>
  <img id="imageguy" src="">
</div>

<!-- Makes canvas to work on. -->
<canvas id="cs"></canvas>

<!-- Displays result. -->
<div class="result">
Click image to randomly pick a color!<br><br>
  <span>HEX: </span>
  <br><br>
  <span>RGB: </span> 
</div>

<script>

//Converts uploaded image into base64.

function encodeImageFileAsURL() {

  var filesSelected = document.getElementById("inputFileToLoad").files;
  if (filesSelected.length > 0) {
    var fileToLoad = filesSelected[0];
    var fileReader = new FileReader();

    fileReader.onload = function(fileLoadedEvent) {
      var srcData = fileLoadedEvent.target.result; // This is the base64 data.
  		//Setting the image on screen to be the base64 version of the image.    
      const imgg = document.getElementById("imageguy");
    	imgg.src = srcData;
      
    }
    fileReader.readAsDataURL(fileToLoad);
  }
}


var img = _('.thumbnail img'),
  canvas = _('#cs'),
  result = _('.result'),
  preview = _('.preview'),x = '',y = '';
  
 //Randomize between image's X and Y when it is clicked.
img.addEventListener('click', function(e){
  if(e.offsetX) {
 x = Math.floor(Math.random() * img.width+1);
	y = Math.floor(Math.random() * img.height+1);
  }
  else if(e.layerX) {
 x = Math.floor(Math.random() * img.width+1);
	y = Math.floor(Math.random() * img.height+1);
  }
  useCanvas(canvas,img,function(){
  var p = canvas.getContext('2d')
  .getImageData(x, y, 1, 1).data;
  result.innerHTML = '<span>HEX: '+rgbToHex(p[0],p[1],p[2])+'</span><br><br>'+
   '<span>RGB:  rgb('+
    p[0]+','+
    p[1]+','+
    p[2]+')</span>';
  
  document.body.style.background =rgbToHex(p[0],p[1],p[2]);
  });
},false);
img.addEventListener('mousemove', function(e){
  if(e.offsetX) {
  x = e.offsetX;
  y = e.offsetY; 
  }
  else if(e.layerX) {
  x = e.layerX;
  y = e.layerY;
  }
  
  useCanvas(canvas,img,function(){
  
  var p = canvas.getContext('2d')
  .getImageData(x, y, 1, 1).data;
  preview.style.background = rgbToHex(p[0],p[1],p[2]);
  });
},false);
function useCanvas(el,image,callback){
  el.width = image.width;
  el.height = image.height; 
  el.getContext('2d')
  .drawImage(image, 0, 0, image.width, image.height);
  return callback();
}
function _(el){
  return document.querySelector(el);
}
function componentToHex(c) {
  var hex = c.toString(16);
  return hex.length == 1 ? "0" + hex : hex;
}
function rgbToHex(r, g, b) {
  return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
}
function findPos(obj) {
  var curleft = 0, curtop = 0;
  if (obj.offsetParent) {
    do {
      curleft += obj.offsetLeft;
      curtop += obj.offsetTop;
    } while (obj = obj.offsetParent);
    return { x: curleft, y: curtop };
  }
  return undefined;
}

</script>

</body>


</html>